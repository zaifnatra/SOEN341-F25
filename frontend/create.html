<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concordia University - Create</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
  <!--This file is about creating accounts. This will appear when a user clicks on creating an account on the log in page
  It handles all the information and creates it in our database as well as redirects user to home page after successful signin.
  -->
    <div class="title-bar">CONCORDIA UNIVERSITY: CAMPUS EVENT TICKETING</div>

    <div class="navbar">
        <a href="index.html">HOME</a>
        <a href="/account" id="account-link" class="active">ACCOUNT</a>
        <a href="/eventspage">EVENTS</a>
        <a id="dashboard-link" href="#">DASHBOARD</a>
        <a href="/recommended" id="for-you-link" style="display:none;">FOR YOU</a>
        <a href="help.html">HELP</a>
    </div>

    <div class="welcome-box">
        <form action="/createAccount" method="post" id="create-account-form">
            <div id="step-1-account">
                <h2 id="logHeader">Create Account</h2>
                <div id="login">
                    <input type="email" placeholder="Email" name="email" id="email-input" required>
                    <input type="text" placeholder="Username" name="username" id="username-input" required>
                    <input type="password" placeholder="Password" name="password" id="password-input" required>
                </div>
                <button type="button" id="next-btn" class="btn">Next</button>
                <div id="reg-link">
                    <p>Already have an account? <a href="signin.html">Login</a></p>
                </div>
            </div>

            <div id="step-2-interests" style="display:none;">
                <h2 id="logHeader">Select Your Interests</h2>
                <p style="margin-bottom: 20px;">This helps us recommend events for you.</p>

                <div class="interests-container" style="text-align: left; max-width: 300px; margin: 0 auto 20px auto; padding-left: 20px;">
                    <label><input type="checkbox" name="interests" value="Academic"> Academic</label><br>
                    <label><input type="checkbox" name="interests" value="Social"> Social</label><br>
                    <label><input type="checkbox" name="interests" value="Workshop"> Workshop</label><br>
                    <label><input type="checkbox" name="interests" value="Sports"> Sports</label><br>
                    <label><input type="checkbox" name="interests" value="Career"> Career</label><br>
                    <label><input type="checkbox" name="interests" value="Arts"> Arts</label><br>
                    <label><input type="checkbox" name="interests" value="Other"> Other</label><br>
                </div>

                <button type="submit" id="finish-btn" class="btn">Finish Account Creation</button>
            </div>
        </form>
    </div>

    <!-- Sign in button uses the same class as signout for positioning -->
    <div class="signout">SIGN IN</div>

    <footer>
        <p>© 2025 Concordia University Campus Event Ticketing | All Rights Reserved</p>
    </footer>

    <script>
document.addEventListener("DOMContentLoaded", () => {
  const nextBtn = document.getElementById("next-btn");
  const step1 = document.getElementById("step-1-account");
  const step2 = document.getElementById("step-2-interests");
  const emailInput = document.getElementById("email-input");
  const usernameInput = document.getElementById("username-input");
  const passwordInput = document.getElementById("password-input");
  const form = document.getElementById("create-account-form");

  let errorEl = document.getElementById("create-email-error");
  if (!errorEl) {
    errorEl = document.createElement("div");
    errorEl.id = "create-email-error";
    errorEl.style.color = "#e50914";
    errorEl.style.marginTop = "8px";
    document.getElementById("login").appendChild(errorEl);
  }

  nextBtn.addEventListener("click", () => {
    const email = emailInput.value.trim();
    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();

    if (!email || !username || !password) {
      errorEl.textContent = "Please fill in all fields before continuing.";
      return;
    }

    errorEl.textContent = "";
    step1.style.display = "none";
    step2.style.display = "block";
  });

  // Handle final submission
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = emailInput.value.trim();
    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();
    const interests = Array.from(
      document.querySelectorAll("input[name='interests']:checked")
    ).map(cb => cb.value);

    const res = await fetch("/createAccount", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, username, password, interests })
    });

    const data = await res.json();

    if (!data.success) {
      // Show inline error (email already exists, etc.)
      step1.style.display = "block";
      step2.style.display = "none";
      errorEl.textContent = data.message;
      return;
    }

    // Success → redirect to sign-in page
    errorEl.textContent = "";
    alert("Account created successfully!");
    window.location.href = "/signin.html";
  });
});
</script>


    <script src="/scripts/index_role.js"></script>
</body>
</html>